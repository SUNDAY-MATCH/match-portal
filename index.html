<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>My Godot Game Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="overlay">
    <img class="bg-base" src="assets/images/シャニマス_空.png" alt="">
  </div>
  <header>
    <h1>シャイニーなゲームおきば</h1>
    <p>283プロのアイドルたちが出てくるゲームを勝手に作りまくっています。</p>
  </header>

  <main id="game-list" class="game-list">
    <!-- JSでここにカードを挿入 -->
  </main>

  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  <script>
    fetch('data/games.yml')
      .then(res => res.text())
      .then(text => {
        const games = jsyaml.load(text);
        console.log('Loaded games:', games);    // ←全体が配列かチェック
        const container = document.getElementById('game-list');
        games.forEach(g => {
          console.log('Game entry:', g);       // ←個別オブジェクトの中身を確認
          const card = document.createElement('div');
          card.className = 'game-card';
          card.innerHTML = `
            <a href="${g.url}" target="_blank">
              <img src="${g.thumb}" alt="${g.name} のサムネイル">
            </a>
            <div class="game-info">
              <h2>
                <a href="${g.url}" target="_blank">${g.name}</a>
              </h2>
              <p><strong>ジャンル：</strong>${g.genre || '—'}</p>
              <p><strong>プレイ時間：</strong>${g.play_time || '—'}</p>
              <p class="game-desc">${g.description}</p>
            </div>
          `;
          container.appendChild(card);
        });
      })
      .catch(err => console.error('YAML load error:', err));
  </script>
  <script>
    (async () => {
      const user    = 'sunday-match';
      const repo    = 'match-portal';           // 例: 'myusername.github.io'
      const dirPath = 'assets/images_background'; // 対象フォルダ

      const apiUrl = `https://api.github.com/repos/${user}/${repo}/contents/${dirPath}`;

      try {
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error(`Error ${res.status}`);
        const files = await res.json();

        // 画像ファイルだけフィルタしてパスを取得
        const imageSources = files
          .filter(f => f.type === 'file' && /\.(png|jpe?g|gif|svg)$/i.test(f.name))
          .map(f => f.download_url);

        console.log(imageSources); // 100個の完全URLが配列で出ます
        // あとはこの配列を使ってスライダーやランダム表示などが自在に！
      } catch (err) {
        console.error('画像一覧取得エラー:', err);
      }
    })();

    const overlay = document.querySelector('.overlay');

    const totalImages = 200; // 🔸表示する画像枚数

    for (let i = 0; i < totalImages; i++) {
      const img = document.createElement('img');
      img.src = imageSources[Math.floor(Math.random() * imageSources.length)];
      img.className = 'bg-float';

      // ランダムな位置（ウィンドウ全体に分散）
      const padding = 50; // 端に寄りすぎないように
      const x = Math.random() * (window.innerWidth - 2 * padding) + padding;
      const y = Math.random() * (window.innerHeight - 2 * padding) + padding;

      // サイズと角度（自然な範囲にランダム化）
      const size = Math.floor(Math.random() * 80) + 100; // 100～180px
      const rot = Math.random() * 60 - 30; // -30～+30度

      img.style.width = `${size}px`;
      img.style.left = `${x}px`;
      img.style.top = `${y}px`;
      img.style.transform = `translate(-50%, -50%) rotate(${rot}deg)`;
      img.style.position = 'absolute';

      overlay.appendChild(img);
    }
  </script>
</body>
</html>
